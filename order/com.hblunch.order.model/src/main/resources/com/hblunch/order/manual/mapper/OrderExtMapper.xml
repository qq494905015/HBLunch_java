<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hblunch.order.manual.dao.OrderExtMapper">
    <resultMap id="BaseResultMap" type="com.hblunch.order.manual.dto.OrderDTO">
        <!--
          @MBG Generated
          This element is automatically generated by MyBatis Generator,Do not modify ! Generated on Fri Oct 27 09:54:09 CST 2017.
        -->
        <id column="id" jdbcType="VARCHAR" property="id" />
        <result column="order_id" jdbcType="VARCHAR" property="orderId" />
        <result column="order_date" jdbcType="VARCHAR" property="orderDate" />
        <result column="type" jdbcType="VARCHAR" property="type" />
        <result column="store_name" jdbcType="VARCHAR" property="storeName" />
        <result column="plation" jdbcType="VARCHAR" property="plation" />
        <result column="phone" jdbcType="VARCHAR" property="phone" />
        <result column="name" jdbcType="VARCHAR" property="name" />
        <result column="address" jdbcType="VARCHAR" property="address" />
        <result column="order_price" jdbcType="DECIMAL" property="orderPrice" />
        <result column="items" jdbcType="VARCHAR" property="items" />
    </resultMap>
    <sql id="Base_Column_List">
        <!--
          @MBG Generated
          This element is automatically generated by MyBatis Generator,Do not modify ! Generated on Fri Oct 27 09:54:09 CST 2017.
        -->
        id, order_id, order_date, type, store_name, plation, phone, name, address, order_price,
        items
    </sql>
    <select id="queryOrderList" parameterType="java.lang.String" resultMap="BaseResultMap">
        SELECT
        t.id,
        t.`order_id`,
        t.`order_date`,
        t.`type`,
        t.`store_name`,
        t.`plation`,
        t.`phone`,
        t.`name`,
        t.`address`,
        SUM(t2.`menu_price`) AS order_price,
        GROUP_CONCAT(t2.`menu_name`) AS menuName,
        GROUP_CONCAT(t2.`menu_count`) AS menuCount,
        GROUP_CONCAT(t2.`menu_price`) AS menuPrice
        FROM
        t_hb_order t
        LEFT JOIN t_hb_order_menu t2
        ON t.id = t2.`order_id`
        where 1=1
        <if test="orderId != null and orderId !=''">
            and order_id = #{orderId,jdbcType=VARCHAR}
        </if>
        <if test="storeName != null and storeName !='' ">
            and store_name = #{storeName,jdbcType=VARCHAR}
        </if>
        <if test="selectStartTime != null and  selectEndTime != null">
            and order_date between #{selectStartTime,jdbcType=VARCHAR} and #{selectEndTime,jdbcType=VARCHAR}
        </if>
        GROUP BY t.`id`
    </select>
</mapper>